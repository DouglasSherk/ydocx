#!/usr/bin/env ruby
# coding: utf-8

require 'json'
require 'optparse'
require 'yaml'
#require 'ruby-prof'

if $0 == __FILE__
  require 'pathname'
  root = Pathname.new(__FILE__).realpath.parent.parent
  $:.unshift root.join('lib')
end

require 'ydocx/document'

options = {}
optparse = OptionParser.new do |opts|
  opts.on('-x', '--extract SECTION', 'Extract the section into the output document') do |section|
    options[:extract_section] = section
  end

  opts.on('-r', '--replace SECTIONS', 'Replace the specified sections with the related documents. ' +
                                      'Expected format is section1=file1,section2=file2,...') do |sections|
    sections = sections.split(',')
    options[:replace_sections] = {}
    sections.each do |replace|
      section, file = replace.split('=')
      options[:replace_sections][section] = YDocx::Document.extract_document(file)
    end
  end
end

optparse.parse!

data = {"_id"=>"14113af780b012bf600f", "account_number"=>{"created_at"=>1379014827, "updated_at"=>1379377060, "value"=>"SOL-01235"}, "address"=>{"created_at"=>1379015197, "updated_at"=>1379374235, "value"=>"123 Yonge St."}, "american_percent"=>{"created_at"=>1379015197, "updated_at"=>1379375316, "value"=>"0"}, "annual_gross_receipts"=>{"created_at"=>1379015197, "updated_at"=>1379375316, "value"=>"999999"}, "annual_payroll"=>{"created_at"=>1379015197, "updated_at"=>1379375316, "value"=>"500000"}, "blanket_coverages"=>{"created_at"=>1379017222, "updated_at"=>1379379817, "value"=>[{"id"=>"1412930a4fa0032ee5e5", "created_at"=>1379375629, "updated_at"=>1379375629, "type"=>{"created_at"=>1379375555, "updated_at"=>1379375555, "value"=>"Umbrella Liability"}, "category"=>{"created_at"=>1379375555, "updated_at"=>1379375555, "value"=>"Umbrella"}, "deductible"=>{"created_at"=>1379375555, "updated_at"=>1379375555, "value"=>""}, "coinsurance"=>{"created_at"=>1379375555, "updated_at"=>1379375555, "value"=>""}, "limit"=>{"created_at"=>1379375555, "updated_at"=>1379375555, "value"=>"10000000"}}, {"id"=>"1412931c61602d49eea1", "created_at"=>1379375629, "updated_at"=>1379375629, "type"=>{"created_at"=>1379375629, "updated_at"=>1379375629, "value"=>"Commercial General Liability"}, "category"=>{"created_at"=>1379375629, "updated_at"=>1379375629, "value"=>"Liability"}, "subtype"=>{"created_at"=>1379375629, "updated_at"=>1379375629, "value"=>"broad"}, "deductible"=>{"created_at"=>1379375629, "updated_at"=>1379375629, "value"=>""}, "coinsurance"=>{"created_at"=>1379375629, "updated_at"=>1379375629, "value"=>""}, "limit"=>{"created_at"=>1379375629, "updated_at"=>1379375629, "value"=>"5000000"}}]}, "brokerage_id"=>{"$oid"=>"51e4374f5ea3b7ed6700000c"}, "business_sector"=>{"created_at"=>1379014827, "updated_at"=>1379096878, "value"=>"Solar"}, "business_start_date"=>{"created_at"=>1379015197, "updated_at"=>1379375180, "value"=>1072933200}, "canadian_percent"=>{"created_at"=>1379015197, "updated_at"=>1379375316, "value"=>"100"}, "city"=>{"created_at"=>1379015197, "updated_at"=>1379374235, "value"=>"Toronto"}, "claims_infos"=>{"created_at"=>1379015197, "updated_at"=>1379379817, "value"=>[{"id"=>"14119c9bb31018ea1fbd", "created_at"=>1379117153, "updated_at"=>1379374811, "loss_date"=>{"created_at"=>1379117153, "updated_at"=>1379117153, "value"=>1379563200}, "claim_type"=>{"created_at"=>1379117153, "updated_at"=>1379374811, "value"=>"Property"}, "description"=>{"created_at"=>1379117153, "updated_at"=>1379374801, "value"=>"Solar panel broke from heavy wind."}, "amount_paid"=>{"created_at"=>1379117153, "updated_at"=>1379374801, "value"=>"9999"}, "reserve"=>{"created_at"=>1379117153, "updated_at"=>1379374801, "value"=>"0"}}, {"id"=>"14129264ff602f34489a", "created_at"=>1379374878, "updated_at"=>1379374878, "loss_date"=>{"created_at"=>1379374878, "updated_at"=>1379374878, "value"=>1346472000}, "claim_type"=>{"created_at"=>1379374878, "updated_at"=>1379374878, "value"=>"Commercial"}, "description"=>{"created_at"=>1379374878, "updated_at"=>1379374878, "value"=>"Theft of equipment from maintenance shed."}, "amount_paid"=>{"created_at"=>1379374878, "updated_at"=>1379374878, "value"=>"543.21"}, "reserve"=>{"created_at"=>1379374878, "updated_at"=>1379374878, "value"=>"0"}}]}, "client_contacts"=>[{"_id"=>"141291def740160f4d87", "client_id"=>"14113af780b012bf600f", "created_at"=>"2013-09-16T23:32:09.000Z", "deleted_at"=>nil, "email"=>{"created_at"=>1379374329, "updated_at"=>1379374329, "value"=>"john@testpower.com"}, "name"=>{"created_at"=>1379374329, "updated_at"=>1379374329, "value"=>"John Smith"}, "updated_at"=>"2013-09-16T23:32:09.000Z", "user"=>{"_id"=>"141291feafa030dfe078", "brokerage_id"=>{"$oid"=>"51e4374f5ea3b7ed6700000c"}, "client_contact_id"=>"141291def740160f4d87", "created_at"=>"2013-09-16T23:34:20.863Z", "deleted_at"=>nil, "email"=>"john@testpower.com", "name"=>"John Smith", "permissions"=>1, "updated_at"=>"2013-09-16T23:34:20.863Z"}}, {"_id"=>"141291fb9bf00d134c09", "client_id"=>"14113af780b012bf600f", "created_at"=>"2013-09-16T23:34:07.000Z", "deleted_at"=>nil, "email"=>{"created_at"=>1379374447, "updated_at"=>1379374447, "value"=>"jane@testpower.com"}, "name"=>{"created_at"=>1379374447, "updated_at"=>1379374447, "value"=>"Jane White"}, "phone"=>{"created_at"=>1379374447, "updated_at"=>1379374447, "value"=>"123-456-7891"}, "position"=>{"created_at"=>1379374447, "updated_at"=>1379374447, "value"=>"Admin. Assistant"}, "salutation"=>{"created_at"=>1379374447, "updated_at"=>1379374447, "value"=>"Mrs."}, "updated_at"=>"2013-09-16T23:35:28.000Z"}], "company_name"=>{"created_at"=>1379014827, "updated_at"=>1379374235, "value"=>"Test Power Co-operative"}, "country"=>{"created_at"=>1379015197, "updated_at"=>1379374235, "value"=>"Canada"}, "covered"=>{"created_at"=>1379015197, "updated_at"=>1379375180, "value"=>"WSIB"}, "created_at"=>"2013-09-12T19:40:30.657Z", "date_known"=>{"created_at"=>1379017236, "updated_at"=>1379375757, "value"=>1378008000}, "deleted_at"=>nil, "description_operations"=>{"created_at"=>1379015280, "updated_at"=>1379374728, "value"=>"A small solar company run by about 30 employees. Operates on a year-long basis, providing about 1 mWh of electricity annually."}, "editing_time"=>1625, "exposure_or_receipts"=>{"created_at"=>1379015197, "updated_at"=>1379375329, "value"=>[]}, "fax"=>{"created_at"=>1379015197, "updated_at"=>1379379816, "value"=>"123-654-0988"}, "foreign_percent"=>{"created_at"=>1379015197, "updated_at"=>1379375316, "value"=>"0"}, "form_of_business"=>{"created_at"=>1379014827, "updated_at"=>1379096878, "value"=>"Corporation"}, "full_time_employees"=>{"created_at"=>1379015197, "updated_at"=>1379375180, "value"=>"25"}, "industry_code"=>{"created_at"=>1379015280, "updated_at"=>1379374589, "value"=>"98765"}, "insurer_offerings"=>{"created_at"=>1379363903, "updated_at"=>1379379817, "value"=>[{"id"=>"1412928df5401ea7d224", "created_at"=>1379375046, "updated_at"=>1379375046, "insurer"=>{"created_at"=>1379375046, "updated_at"=>1379375046, "value"=>"Canadian Solar Insurer"}, "policy_number"=>{"created_at"=>1379375046, "updated_at"=>1379375046, "value"=>"SOL12345"}, "umbrella_premium"=>{"created_at"=>1379375046, "updated_at"=>1379375046, "value"=>"1000"}, "commercial_premium"=>{"created_at"=>1379375046, "updated_at"=>1379375046, "value"=>"234.56"}, "total_premium"=>{"created_at"=>1379375046, "updated_at"=>1379375046, "value"=>"1234.56"}, "chosen_insurer"=>{"created_at"=>1379375046, "updated_at"=>1379375046, "value"=>{"yes"=>true}}}, {"id"=>"14129292a4901ec8bd56", "created_at"=>1379375065, "updated_at"=>1379375065, "insurer"=>{"created_at"=>1379375065, "updated_at"=>1379375065, "value"=>"Aviva Insurance"}, "policy_number"=>{"created_at"=>1379375065, "updated_at"=>1379375065, "value"=>"123456"}, "umbrella_premium"=>{"created_at"=>1379375065, "updated_at"=>1379375065, "value"=>"900"}, "commercial_premium"=>{"created_at"=>1379375065, "updated_at"=>1379375065, "value"=>"500"}, "total_premium"=>{"created_at"=>1379375065, "updated_at"=>1379375065, "value"=>"1400"}}, {"id"=>"1412929c12602e6808a9", "created_at"=>1379375104, "updated_at"=>1379375104, "insurer"=>{"created_at"=>1379375104, "updated_at"=>1379375104, "value"=>"Other Insurer"}, "policy_number"=>{"created_at"=>1379375104, "updated_at"=>1379375104, "value"=>"9999"}, "umbrella_premium"=>{"created_at"=>1379375104, "updated_at"=>1379375104, "value"=>"1234"}, "commercial_premium"=>{"created_at"=>1379375104, "updated_at"=>1379375104, "value"=>"1234"}, "total_premium"=>{"created_at"=>1379375104, "updated_at"=>1379375104, "value"=>"2468"}}]}, "locations"=>{"created_at"=>1379015431, "updated_at"=>1379379817, "value"=>[{"id"=>"141293466f5016d3e053", "created_at"=>1379375819, "updated_at"=>1379379817, "location_number"=>{"created_at"=>1379375819, "updated_at"=>1379375819, "value"=>"001"}, "location_type"=>{"created_at"=>1379375819, "updated_at"=>1379375819, "value"=>"Rural"}, "location_address"=>{"created_at"=>1379375886, "updated_at"=>1379375886, "value"=>"345 Pepperidge Road"}, "location_city"=>{"created_at"=>1379375886, "updated_at"=>1379375886, "value"=>"Barrie"}, "country"=>{"created_at"=>1379375886, "updated_at"=>1379375886, "value"=>"Canada"}, "province"=>{"created_at"=>1379375886, "updated_at"=>1379375886, "value"=>"Ontario"}, "location_postal_code"=>{"created_at"=>1379375886, "updated_at"=>1379375886, "value"=>"T1P 2C3"}, "solar_project_type"=>{"created_at"=>1379375886, "updated_at"=>1379375886, "value"=>"Photovoltaic (PV)"}, "pv_mounting_type"=>{"created_at"=>1379375886, "updated_at"=>1379375913, "value"=>"rooftop"}, "solar_mounting_structure"=>{"created_at"=>1379375913, "updated_at"=>1379375913, "value"=>"Stationary"}, "solar_structure_type"=>{"created_at"=>1379375932, "updated_at"=>1379375950, "value"=>"Transformers and storage"}, "solar_location_operation"=>{"created_at"=>1379375950, "updated_at"=>1379375950, "value"=>"yearRound"}, "solar_roof_leased"=>{"created_at"=>1379375950, "updated_at"=>1379375950, "value"=>{}}, "solar_engineering_evaluation"=>{"created_at"=>1379375950, "updated_at"=>1379375950, "value"=>{"yes"=>true}}, "pv_manufacturer"=>{"created_at"=>1379376175, "updated_at"=>1379376175, "value"=>"Suntech"}, "pv_panels"=>{"created_at"=>1379376175, "updated_at"=>1379376175, "value"=>"123"}, "pv_capacity"=>{"created_at"=>1379376175, "updated_at"=>1379376175, "value"=>"1 mW"}, "pv_inverter_manufacturer"=>{"created_at"=>1379376175, "updated_at"=>1379376175, "value"=>"Xantrex"}, "pv_inverter_count"=>{"created_at"=>1379376175, "updated_at"=>1379376175, "value"=>"10"}, "pv_transformer_count"=>{"created_at"=>1379376175, "updated_at"=>1379376175, "value"=>"7"}, "pv_equipment_used"=>{"created_at"=>1379376175, "updated_at"=>1379376175, "value"=>{"yes"=>true}}, "pv_equipment_details"=>{"created_at"=>1379376175, "updated_at"=>1379376175, "value"=>"Transformers are used; roughly 1 year old"}, "pv_equipment_type"=>{"created_at"=>1379376175, "updated_at"=>1379376175, "value"=>"Community/Joint ownership"}, "pv_year_installed"=>{"created_at"=>1379376175, "updated_at"=>1379376175, "value"=>"2004"}, "pv_installer"=>{"created_at"=>1379376175, "updated_at"=>1379376175, "value"=>"Canadian Construction Company"}, "pv_installer_sia"=>{"created_at"=>1379376175, "updated_at"=>1379376175, "value"=>{}}, "solar_preventative_maintenance"=>{"created_at"=>1379376175, "updated_at"=>1379376175, "value"=>{"yes"=>true}}, "solar_spares"=>{"created_at"=>1379376175, "updated_at"=>1379376175, "value"=>"Kept in building across the street"}, "solar_own_substation"=>{"created_at"=>1379376175, "updated_at"=>1379376175, "value"=>{}}, "solar_non_owned_distance"=>{"created_at"=>1379376175, "updated_at"=>1379376175, "value"=>"200m"}, "solar_non_owned_power_lines"=>{"created_at"=>1379376175, "updated_at"=>1379376175, "value"=>"overhead"}, "solar_annual_revenue"=>{"created_at"=>1379376175, "updated_at"=>1379376175, "value"=>"987654"}, "solar_system_log"=>{"created_at"=>1379376175, "updated_at"=>1379376175, "value"=>{}}, "solar_scada"=>{"created_at"=>1379376175, "updated_at"=>1379376175, "value"=>{"yes"=>true}}, "solar_scada_signal"=>{"created_at"=>1379376175, "updated_at"=>1379376175, "value"=>"Main offices"}, "solar_contingency_plans"=>{"created_at"=>1379376175, "updated_at"=>1379376175, "value"=>"Backup equipment in shed"}, "solar_warranty"=>{"created_at"=>1379376175, "updated_at"=>1379376175, "value"=>{"yes"=>true}}, "solar_warranty_expiry"=>{"created_at"=>1379376175, "updated_at"=>1379376175, "value"=>1441080000}, "inspection"=>{"created_at"=>1379376175, "updated_at"=>1379376175, "value"=>"yes"}, "inspection_date"=>{"created_at"=>1379376175, "updated_at"=>1379376175, "value"=>1378094400}, "inspected_by"=>{"created_at"=>1379376175, "updated_at"=>1379376175, "value"=>"John Smith"}, "risk_severity"=>{"created_at"=>1379376175, "updated_at"=>1379376175, "value"=>"veryGood"}, "risk_info_notes"=>{"created_at"=>1379376175, "updated_at"=>1379376175, "value"=>"Lorem ipsum dolor sit amet, consectetur adipiscing elit."}, "risk_info_limit"=>{"created_at"=>1379376175, "updated_at"=>1379376175, "value"=>"1000000"}, "year_built"=>{"created_at"=>1379376175, "updated_at"=>1379376175, "value"=>"2003"}, "construction_walls"=>{"created_at"=>1379376175, "updated_at"=>1379376175, "value"=>"Solid Brick"}, "construction_roof"=>{"created_at"=>1379376175, "updated_at"=>1379376175, "value"=>"Steel Beam"}, "renovations_none_known"=>{"created_at"=>1379376175, "updated_at"=>1379376175, "value"=>{}}, "renovations_electrical"=>{"created_at"=>1379376175, "updated_at"=>1379376175, "value"=>{"yes"=>true}}, "renovations_electrical_year"=>{"created_at"=>1379376175, "updated_at"=>1379376175, "value"=>"2006"}, "renovations_electrical_complete_partial"=>{"created_at"=>1379376175, "updated_at"=>1379376175, "value"=>"partial"}, "renovations_roof"=>{"created_at"=>1379376175, "updated_at"=>1379376175, "value"=>{"yes"=>true}}, "renovations_roof_year"=>{"created_at"=>1379376175, "updated_at"=>1379376175, "value"=>"2010"}, "renovations_roof_complete_partial"=>{"created_at"=>1379376175, "updated_at"=>1379376175, "value"=>"complete"}, "fire_hydrants"=>{"created_at"=>1379376258, "updated_at"=>1379376258, "value"=>"Within 150m"}, "fire_department"=>{"created_at"=>1379376258, "updated_at"=>1379376258, "value"=>"Within 8km"}, "extinguishing_system"=>{"created_at"=>1379376258, "updated_at"=>1379376258, "value"=>"Sprinkler"}, "extinguishing_agent"=>{"created_at"=>1379376258, "updated_at"=>1379376258, "value"=>"chemical"}, "fire_alarm"=>{"created_at"=>1379376258, "updated_at"=>1379376258, "value"=>"Central Station"}, "coverage_percent"=>{"created_at"=>1379376258, "updated_at"=>1379376258, "value"=>"90"}, "standpipe"=>{"created_at"=>1379376258, "updated_at"=>1379376258, "value"=>{}}, "other_fire_info"=>{"created_at"=>1379376258, "updated_at"=>1379376344, "value"=>"Fuses have not been inspected recently."}, "coverage_schedules"=>{"created_at"=>1379376509, "updated_at"=>1379379817, "value"=>[{"id"=>"141293f3077005861b54", "created_at"=>1379376509, "updated_at"=>1379376509, "type"=>{"created_at"=>1379376509, "updated_at"=>1379376509, "value"=>"Earthquake"}, "category"=>{"created_at"=>1379376509, "updated_at"=>1379376509, "value"=>"Property"}, "deductible"=>{"created_at"=>1379376509, "updated_at"=>1379376509, "value"=>"100000 min 3%"}, "coinsurance"=>{"created_at"=>1379376509, "updated_at"=>1379376509, "value"=>""}, "limit"=>{"created_at"=>1379376509, "updated_at"=>1379376509, "value"=>"1000000"}}, {"id"=>"141293f3077033851729", "created_at"=>1379376509, "updated_at"=>1379376509, "type"=>{"created_at"=>1379376509, "updated_at"=>1379376509, "value"=>"Building"}, "category"=>{"created_at"=>1379376509, "updated_at"=>1379376509, "value"=>"Property"}, "subtype"=>{"created_at"=>1379376509, "updated_at"=>1379376509, "value"=>"broad"}, "deductible"=>{"created_at"=>1379376509, "updated_at"=>1379376509, "value"=>"1000"}, "coinsurance"=>{"created_at"=>1379376509, "updated_at"=>1379376509, "value"=>"90%"}, "limit"=>{"created_at"=>1379376509, "updated_at"=>1379376509, "value"=>"123456"}}, {"id"=>"141293f3078001b7e5b9", "created_at"=>1379376509, "updated_at"=>1379376509, "type"=>{"created_at"=>1379376509, "updated_at"=>1379376509, "value"=>"Windstorm/Hail"}, "category"=>{"created_at"=>1379376509, "updated_at"=>1379376509, "value"=>"Property"}, "deductible"=>{"created_at"=>1379376509, "updated_at"=>1379376509, "value"=>"25000"}, "coinsurance"=>{"created_at"=>1379376509, "updated_at"=>1379376509, "value"=>""}, "limit"=>{"created_at"=>1379376509, "updated_at"=>1379376509, "value"=>"1000000"}}, {"id"=>"141293f3078008a7d50e", "created_at"=>1379376509, "updated_at"=>1379376509, "type"=>{"created_at"=>1379376509, "updated_at"=>1379376509, "value"=>"Money & Securities"}, "category"=>{"created_at"=>1379376509, "updated_at"=>1379376509, "value"=>"Crime"}, "subtype"=>{"created_at"=>1379376509, "updated_at"=>1379376509, "value"=>"broad"}, "deductible"=>{"created_at"=>1379376509, "updated_at"=>1379376509, "value"=>"1000"}, "coinsurance"=>{"created_at"=>1379376509, "updated_at"=>1379376509, "value"=>"90%"}, "limit"=>{"created_at"=>1379376509, "updated_at"=>1379376509, "value"=>"10000"}}, {"id"=>"141293f30780128691b2", "created_at"=>1379376509, "updated_at"=>1379376509, "type"=>{"created_at"=>1379376509, "updated_at"=>1379376509, "value"=>"Damage to Building by Burglary or Robbery"}, "category"=>{"created_at"=>1379376509, "updated_at"=>1379376509, "value"=>"Crime"}, "deductible"=>{"created_at"=>1379376509, "updated_at"=>1379376509, "value"=>"1000"}, "coinsurance"=>{"created_at"=>1379376509, "updated_at"=>1379376509, "value"=>"90%"}, "limit"=>{"created_at"=>1379376509, "updated_at"=>1379376509, "value"=>"25000"}}, {"id"=>"141293f3078015790621", "created_at"=>1379376509, "updated_at"=>1379376509, "type"=>{"created_at"=>1379376509, "updated_at"=>1379376509, "value"=>"Master Key"}, "category"=>{"created_at"=>1379376509, "updated_at"=>1379376509, "value"=>"Property"}, "subtype"=>{"created_at"=>1379376509, "updated_at"=>1379376509, "value"=>"broad"}, "deductible"=>{"created_at"=>1379376509, "updated_at"=>1379376509, "value"=>"1000"}, "coinsurance"=>{"created_at"=>1379376509, "updated_at"=>1379376509, "value"=>""}, "limit"=>{"created_at"=>1379376509, "updated_at"=>1379376509, "value"=>"25000"}}, {"id"=>"141293f3078020e1ffec", "created_at"=>1379376509, "updated_at"=>1379376509, "type"=>{"created_at"=>1379376509, "updated_at"=>1379376509, "value"=>"Contractor’s Equipment Floater"}, "category"=>{"created_at"=>1379376509, "updated_at"=>1379376509, "value"=>"Property"}, "subtype"=>{"created_at"=>1379376509, "updated_at"=>1379376509, "value"=>"broad"}, "deductible"=>{"created_at"=>1379376509, "updated_at"=>1379376509, "value"=>"1000"}, "coinsurance"=>{"created_at"=>1379376509, "updated_at"=>1379376509, "value"=>"100%"}, "limit"=>{"created_at"=>1379376509, "updated_at"=>1379376509, "value"=>"30000"}}, {"id"=>"141293f3078021851e0e", "created_at"=>1379376509, "updated_at"=>1379376509, "type"=>{"created_at"=>1379376509, "updated_at"=>1379376509, "value"=>"Flood"}, "category"=>{"created_at"=>1379376509, "updated_at"=>1379376509, "value"=>"Property"}, "deductible"=>{"created_at"=>1379376509, "updated_at"=>1379376509, "value"=>"25000"}, "limit"=>{"created_at"=>1379376509, "updated_at"=>1379376509, "value"=>"1000000"}}, {"id"=>"141293f3078026a94f65", "created_at"=>1379376509, "updated_at"=>1379376509, "type"=>{"created_at"=>1379376509, "updated_at"=>1379376509, "value"=>"Lightning"}, "category"=>{"created_at"=>1379376509, "updated_at"=>1379376509, "value"=>"Property"}, "deductible"=>{"created_at"=>1379376509, "updated_at"=>1379376509, "value"=>"100000 min 3%"}, "limit"=>{"created_at"=>1379376509, "updated_at"=>1379376509, "value"=>"1000000"}}, {"id"=>"141293f30780293fe57d", "created_at"=>1379376509, "updated_at"=>1379376509, "type"=>{"created_at"=>1379376509, "updated_at"=>1379376509, "value"=>"Equipment"}, "category"=>{"created_at"=>1379376509, "updated_at"=>1379376509, "value"=>"Property"}, "subtype"=>{"created_at"=>1379376509, "updated_at"=>1379376509, "value"=>"broad"}, "replacement_cost"=>{"created_at"=>1379376509, "updated_at"=>1379376509, "value"=>"54321"}, "deductible"=>{"created_at"=>1379376509, "updated_at"=>1379376509, "value"=>""}, "coinsurance"=>{"created_at"=>1379376509, "updated_at"=>1379376509, "value"=>"90%"}, "limit"=>{"created_at"=>1379376509, "updated_at"=>1379376509, "value"=>"54321"}}]}}]}, "new_client"=>{"created_at"=>1379017236, "updated_at"=>1379361640, "value"=>{}}, "notes"=>{"created_at"=>1379017236, "updated_at"=>1379375668, "value"=>"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Fusce commodo magna et nibh porttitor, a placerat tellus dapibus. Mauris blandit ut nulla eget fermentum. Nunc rhoncus mi non dictum tempus. Integer a lacinia dolor. Etiam condimentum enim at egestas rhoncus. Nullam eros sapien, feugiat sed vehicula eget, fermentum dapibus justo. Proin suscipit augue eget lacus viverra lacinia. Maecenas dignissim adipiscing sapien, in hendrerit nibh posuere eget. Donec ut quam accumsan, interdum dolor et, vulputate purus. Cum sociis natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Phasellus ornare, nibh a imperdiet imperdiet, enim mi tempor lorem, ut rhoncus nisl nibh quis magna."}, "part_time_employees"=>{"created_at"=>1379015197, "updated_at"=>1379375180, "value"=>"5"}, "phone"=>{"created_at"=>1379015197, "updated_at"=>1379374235, "value"=>"123-456-7890 ext. 888"}, "policy_end"=>{"created_at"=>1379361052, "updated_at"=>1379375766, "value"=>1420110000}, "policy_infos"=>{"created_at"=>1379015197, "updated_at"=>1379379817, "value"=>[{"id"=>"14129277ac30392b93e7", "created_at"=>1379374955, "updated_at"=>1379374980, "insurer"=>{"created_at"=>1379374955, "updated_at"=>1379374955, "value"=>"Canadian Solar Insurer"}, "policy_type"=>{"created_at"=>1379374955, "updated_at"=>1379374955, "value"=>"Environmental"}, "policy_number"=>{"created_at"=>1379374955, "updated_at"=>1379374955, "value"=>"SOL12345"}, "premium"=>{"created_at"=>1379374955, "updated_at"=>1379374955, "value"=>"1234.56"}, "premium_monthly_or_annual"=>{"created_at"=>1379374955, "updated_at"=>1379374955, "value"=>"annually"}, "policy_start"=>{"created_at"=>1379374955, "updated_at"=>1379374980, "value"=>1325394000}, "policy_end"=>{"created_at"=>1379374955, "updated_at"=>1379374980, "value"=>1357016400}}, {"id"=>"14129286b7f00362faae", "created_at"=>1379375016, "updated_at"=>1379375016, "insurer"=>{"created_at"=>1379375016, "updated_at"=>1379375016, "value"=>"Aviva Insurance"}, "policy_type"=>{"created_at"=>1379375016, "updated_at"=>1379375016, "value"=>"CGL"}, "policy_number"=>{"created_at"=>1379375016, "updated_at"=>1379375016, "value"=>"123456"}, "premium"=>{"created_at"=>1379375016, "updated_at"=>1379375016, "value"=>"1023.45"}, "premium_monthly_or_annual"=>{"created_at"=>1379375016, "updated_at"=>1379375016, "value"=>""}, "policy_start"=>{"created_at"=>1379375016, "updated_at"=>1379375016, "value"=>1357016400}, "policy_end"=>{"created_at"=>1379375016, "updated_at"=>1379375016, "value"=>1388574000}}]}, "policy_start"=>{"created_at"=>1379361036, "updated_at"=>1379375766, "value"=>1388552400}, "postal_code"=>{"created_at"=>1379015197, "updated_at"=>1379374235, "value"=>"T1P 2C3"}, "province"=>{"created_at"=>1379015197, "updated_at"=>1379374235, "value"=>"Ontario"}, "quote_required_by_asap"=>{"created_at"=>1379360985, "updated_at"=>1379375766, "value"=>{"yes"=>true}}, "solar_annual_energy"=>{"created_at"=>1379015197, "updated_at"=>1379375180, "value"=>"1 mWh"}, "solar_energy_sold_to"=>{"created_at"=>1379015197, "updated_at"=>1379375180, "value"=>"Utility"}, "solar_host"=>{"created_at"=>1379015197, "updated_at"=>1379375180, "value"=>"Solvanas Rex"}, "solar_lessor"=>{"created_at"=>1379015197, "updated_at"=>1379375316, "value"=>"Lesley Sorento"}, "solar_non_workers_compensation"=>{"created_at"=>1379015197, "updated_at"=>1379375316, "value"=>"1"}, "solar_non_workers_compensation_class"=>{"created_at"=>1379375316, "updated_at"=>1379375316, "value"=>"Office"}, "solar_project_restricted"=>{"created_at"=>1379015197, "updated_at"=>1379096878, "value"=>{"yes"=>true}}, "solar_project_restricted_describe"=>{"created_at"=>1379015197, "updated_at"=>1379375316, "value"=>"Employees only"}, "solar_subcontractor_coverage"=>{"created_at"=>1379015197, "updated_at"=>1379096878, "value"=>{"yes"=>true}}, "solar_subcontractor_coverage_additional_insured"=>{"created_at"=>1379015197, "updated_at"=>1379096878, "value"=>{"yes"=>true}}, "solar_subcontractor_coverage_certificates"=>{"created_at"=>1379015197, "updated_at"=>1379096878, "value"=>{"yes"=>true}}, "solar_subcontractor_coverage_limit"=>{"created_at"=>1379015197, "updated_at"=>1379375316, "value"=>"1000000"}, "solar_subcontractor_coverage_planned_describe"=>{"created_at"=>1379015197, "updated_at"=>1379375316, "value"=>"Expansion of west side of panel farm"}, "solar_subcontractor_coverage_planned_sites"=>{"created_at"=>1379015197, "updated_at"=>1379096878, "value"=>{"yes"=>true}}, "solar_subcontractor_coverage_waive"=>{"created_at"=>1379015197, "updated_at"=>1379375316, "value"=>{}}, "solar_subcontracts"=>{"created_at"=>1379015197, "updated_at"=>1379375316, "value"=>"Maintenance of solar panels"}, "solar_transmission"=>{"created_at"=>1379015197, "updated_at"=>1379375316, "value"=>{}}, "solar_transmission_describe"=>{"created_at"=>1379015197, "updated_at"=>1379375316, "value"=>""}, "solar_utility"=>{"created_at"=>1379015197, "updated_at"=>1379375180, "value"=>"Ontario Hydro"}, "updated_at"=>"2013-09-17T01:03:37.000Z", "website"=>{"created_at"=>1379015197, "updated_at"=>1379374235, "value"=>"www.testpower.com"}}
data['brokerage_short'] = 'NII'
data['company_short'] = 'C'
data['brokerage'] = JSON.parse('{"_id":{"$oid":"51e4374f5ea3b7ed6700000c"},"address":"315 King St. N","clients":[{"_id":"14103e979da016ec3e87","blanket_coverages":{"created_at":1378753028,"updated_at":1378845894,"value":[{"id":"141098edfe902828876d","created_at":1378844860,"updated_at":1378844860,"type":{"created_at":1378844860,"updated_at":1378844860,"value":"Accounts Receivable (Broad)"},"category":{"created_at":1378844860,"updated_at":1378844860,"value":"Property"},"deductible":{"created_at":1378844860,"updated_at":1378844860,"value":"1000"},"coinsurance":{"created_at":1378844860,"updated_at":1378844860,"value":""},"limit":{"created_at":1378844860,"updated_at":1378844860,"value":"50000"}}]},"brokerage_id":{"$oid":"51e4374f5ea3b7ed6700000c"},"business_sector":{"created_at":1378750152,"updated_at":1378750152,"value":"Generic"},"claims_infos":{"created_at":1378844910,"updated_at":1378845894,"value":[{"id":"1410995c21e037e54f58","created_at":1378845311,"updated_at":1378845343,"loss_date":{"created_at":1378845311,"updated_at":1378845311,"value":1378180800},"claim_type":{"created_at":1378845331,"updated_at":1378845343,"value":""}}]},"company_name":{"created_at":1378750152,"updated_at":1378750152,"value":"Test Company"},"covered":{"created_at":1378838244,"updated_at":1378838244,"value":""},"created_at":"2013-09-09T18:09:12.892Z","deleted_at":null,"editing_time":321,"form_of_business":{"created_at":1378845156,"updated_at":1378845156,"value":"Individual"},"locations":{"created_at":1378750185,"updated_at":1378845894,"value":[{"id":"14103e9df9203b068efd","created_at":1378750185,"updated_at":1378845894,"location_number":{"created_at":1378750185,"updated_at":1378750185,"value":"1"},"construction_area":{"created_at":1378753331,"updated_at":1378753331,"value":{"qty":"1234","unit":"Sq. m."}},"renovations_plumbing":{"created_at":1378753338,"updated_at":1378753338,"value":{}},"buildings":{"created_at":1378750684,"updated_at":1378845894,"value":[{"id":"141098bcb1b03a438de9","created_at":1378844658,"updated_at":1378844658,"building_number":{"created_at":1378844658,"updated_at":1378844658,"value":"1234"}}]},"coverage_schedules":{"created_at":1378750185,"updated_at":1378845894,"value":[{"id":"141055f19d601807ec7f","created_at":1378774620,"updated_at":1378774620,"type":{"created_at":1378774620,"updated_at":1378774620,"value":"Computers"},"category":{"created_at":1378774620,"updated_at":1378774620,"value":"Property"},"subtype":{"created_at":1378774620,"updated_at":1378774620,"value":"broad"},"deductible":{"created_at":1378774620,"updated_at":1378774620,"value":"1000"},"coinsurance":{"created_at":1378774620,"updated_at":1378774620,"value":"90%"},"limit":{"created_at":1378774620,"updated_at":1378774620,"value":"25000"}}]}},{"id":"141098deebc025ba4a12","created_at":1378844812,"updated_at":1378844812,"location_number":{"created_at":1378844812,"updated_at":1378844812,"value":"2"},"location_type":{"created_at":1378844812,"updated_at":1378844812,"value":"Urban"}}]},"policy_infos":{"created_at":1378844471,"updated_at":1378844765,"value":[]},"prev_policy_infos":{"created_at":1378845892,"updated_at":1378845894,"value":[{"id":"141099e9f93018b3fa04","created_at":1378845892,"updated_at":1378845892,"insurer":{"created_at":1378845892,"updated_at":1378845892,"value":"1234"},"policy_type":{"created_at":1378845892,"updated_at":1378845892,"value":"CGL"}}]},"updated_at":"2013-09-10T20:44:54.000Z","website":{"created_at":1378844905,"updated_at":1378845818,"value":""}},{"_id":"14109a001d602530b7a8","account_number":{"created_at":1378846443,"updated_at":1378846469,"value":"12345"},"brokerage_id":{"$oid":"51e4374f5ea3b7ed6700000c"},"business_sector":{"created_at":1378845993,"updated_at":1378845993,"value":"Generic"},"company_name":{"created_at":1378845993,"updated_at":1378845993,"value":"SciGit"},"created_at":"2013-09-10T20:46:33.435Z","deleted_at":null,"editing_time":91,"form_of_business":{"created_at":1378845993,"updated_at":1378845993,"value":"Corporation"},"updated_at":"2013-09-10T20:57:48.000Z","website":{"created_at":1378846029,"updated_at":1378846668,"value":"12345"}}],"contacts":[{"name":"asdf","title":"asdf"}],"created_at":"2013-07-15T17:54:23.641Z","deleted_at":null,"employees":22,"fax":"","name":"SciGit Inc.","num_clients":null,"phone":"5194048124","updated_at":"2013-08-15T23:26:45.765Z","website":"www.scigit.com"}')

fields = YAML::load(File.open('client.yml'))
argv = ARGV.dup
if !argv[0].nil?
  if defined? RubyProf
    RubyProf.start
  end

  YDocx::Document.fill_template(argv[0], data, fields, argv[1] || (File.basename(argv[0], '.docx') + '.out.docx'), options)
  if defined? RubyProf
    result = RubyProf.stop
    printer = RubyProf::GraphHtmlPrinter.new(result)
    printer.print(STDOUT)
  end
  puts 'Successfully filled template with data.'
else
  puts 'usage: templatex [options] template_file output_file'
end
