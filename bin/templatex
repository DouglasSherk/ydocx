#!/usr/bin/env ruby
# coding: utf-8

require 'json'
require 'optparse'
require 'yaml'
#require 'ruby-prof'

if $0 == __FILE__
  require 'pathname'
  root = Pathname.new(__FILE__).realpath.parent.parent
  $:.unshift root.join('lib')
end

require 'ydocx/document'

options = {}
optparse = OptionParser.new do |opts|
  opts.on('-x', '--extract SECTION', 'Extract the section into the output document') do |section|
    options[:extract_section] = section
  end

  opts.on('-r', '--replace SECTIONS', 'Replace the specified sections with the related documents. ' +
                                      'Expected format is section1=file1,section2=file2,...') do |sections|
    sections = sections.split(',')
    options[:replace_sections] = {}
    sections.each do |replace|
      section, file = replace.split('=')
      options[:replace_sections][section] = YDocx::Document.extract_document(file)
    end
  end
end

optparse.parse!

data = JSON.parse('{"_id":"14113af780b012bf600f","account_number":{"created_at":1379014827,"updated_at":1379015688,"value":"Account Numberr"},"address":{"created_at":1379015197,"updated_at":1379015688,"value":"Addresss"},"american_percent":{"created_at":1379015197,"updated_at":1379015688,"value":"11"},"annual_gross_receipts":{"created_at":1379015197,"updated_at":1379015688,"value":"111.11"},"annual_payroll":{"created_at":1379015197,"updated_at":1379015688,"value":"11"},"blanket_coverages":{"created_at":1379017222,"updated_at":1379017417,"value":[{"id":"14113d4e9cc0169496c3","created_at":1379017222,"updated_at":1379017222,"type":{"created_at":1379017222,"updated_at":1379017222,"value":"Misc. Wording"},"category":{"created_at":1379017222,"updated_at":1379017222,"value":"Other"},"deductible":{"created_at":1379017222,"updated_at":1379017222,"value":"1111"},"coinsurance":{"created_at":1379017222,"updated_at":1379017222,"value":"coninsurancee"},"limit":{"created_at":1379017222,"updated_at":1379017222,"value":"11"},"premium":{"created_at":1379017222,"updated_at":1379017222,"value":"ratee premiumm"}}]},"brokerage_id":{"$oid":"51e4374f5ea3b7ed6700000c"},"business_sector":{"created_at":1379014827,"updated_at":1379015688,"value":"Solar"},"business_start_date":{"created_at":1379015197,"updated_at":1379015688,"value":1378872000},"canadian_percent":{"created_at":1379015197,"updated_at":1379015688,"value":"11"},"city":{"created_at":1379015197,"updated_at":1379015688,"value":"Cityy"},"claims_infos":{"created_at":1379015197,"updated_at":1379017417,"value":[{"id":"14113b2e3dc0093f792c","created_at":1379015197,"updated_at":1379015197,"loss_date":{"created_at":1379015197,"updated_at":1379015197,"value":1379563200},"claim_type":{"created_at":1379015197,"updated_at":1379015197,"value":"type ofclaim"},"description":{"created_at":1379015197,"updated_at":1379015197,"value":"descrip"},"amount_paid":{"created_at":1379015197,"updated_at":1379015197,"value":"111.11"},"reserve":{"created_at":1379015197,"updated_at":1379015197,"value":"111.11"}}]},"company_name":{"created_at":1379014827,"updated_at":1379015688,"value":"Companyy Name"},"country":{"created_at":1379015197,"updated_at":1379015688,"value":"Countryyy"},"covered":{"created_at":1379015197,"updated_at":1379015688,"value":"coverdd by"},"created_at":"2013-09-12T19:40:30.657Z","date_known":{"created_at":1379017236,"updated_at":1379017236,"value":1379908800},"deleted_at":null,"description_operations":{"created_at":1379015280,"updated_at":1379015688,"value":"description of operationsss"},"editing_time":493,"exposure_or_receipts":{"created_at":1379015197,"updated_at":1379017417,"value":[{"id":"14113b4fa8601e134962","created_at":1379015197,"updated_at":1379015197,"operation_or_product_type":{"created_at":1379015197,"updated_at":1379015197,"value":"operation or product typee"},"annual_percent_or_dollar":{"created_at":1379015197,"updated_at":1379015197,"value":"annual % or $"},"change_from_last_year":{"created_at":1379015197,"updated_at":1379015197,"value":"1111.11"}}]},"fax":{"created_at":1379015197,"updated_at":1379015688,"value":"123-345-1223"},"foreign_percent":{"created_at":1379015197,"updated_at":1379015688,"value":"11"},"form_of_business":{"created_at":1379014827,"updated_at":1379015688,"value":"Corporation"},"full_time_employees":{"created_at":1379015197,"updated_at":1379015688,"value":"fulltimeemploy"},"industry_code":{"created_at":1379015280,"updated_at":1379015688,"value":"11111"},"locations":{"created_at":1379015431,"updated_at":1379017417,"value":[{"id":"14113b75c5500cf0931a","created_at":1379015431,"updated_at":1379017417,"location_number":{"created_at":1379015431,"updated_at":1379015431,"value":"1"},"location_type":{"created_at":1379015431,"updated_at":1379015431,"value":"Rural"},"location_address":{"created_at":1379015431,"updated_at":1379015431,"value":"addresss"},"location_city":{"created_at":1379015431,"updated_at":1379015431,"value":"cityy"},"country":{"created_at":1379015431,"updated_at":1379015431,"value":"countri"},"province":{"created_at":1379015431,"updated_at":1379015431,"value":"Yukon Territory"},"location_postal_code":{"created_at":1379015431,"updated_at":1379015431,"value":"posta code"},"solar_project_type":{"created_at":1379015431,"updated_at":1379015431,"value":"type of projectt"},"solar_mounting_structure":{"created_at":1379015431,"updated_at":1379015431,"value":"Stationary"},"solar_preventative_maintenance":{"created_at":1379015431,"updated_at":1379015431,"value":{"yes":true}},"solar_spares":{"created_at":1379015431,"updated_at":1379015431,"value":"sparess"},"solar_own_substation":{"created_at":1379015431,"updated_at":1379015431,"value":{"yes":true}},"solar_non_owned_distance":{"created_at":1379015431,"updated_at":1379015431,"value":"non-owned substation distancee"},"solar_non_owned_power_lines":{"created_at":1379015431,"updated_at":1379015431,"value":"buried"},"solar_annual_revenue":{"created_at":1379015431,"updated_at":1379015431,"value":"annual power generation revenuee"},"solar_system_log":{"created_at":1379015431,"updated_at":1379015431,"value":{"yes":true}},"solar_scada":{"created_at":1379015431,"updated_at":1379015431,"value":{"yes":true}},"solar_scada_signal":{"created_at":1379015431,"updated_at":1379015431,"value":"scada signall"},"solar_contingency_plans":{"created_at":1379015431,"updated_at":1379015431,"value":"contingency plans"},"solar_warranty":{"created_at":1379015431,"updated_at":1379015431,"value":{"yes":true}},"solar_warranty_expiry":{"created_at":1379015431,"updated_at":1379015431,"value":1379995200},"inspection":{"created_at":1379015431,"updated_at":1379015431,"value":"yes"},"inspection_date":{"created_at":1379015431,"updated_at":1379015431,"value":1379476800},"inspected_by":{"created_at":1379015431,"updated_at":1379015431,"value":"inspected byy"},"risk_severity":{"created_at":1379015431,"updated_at":1379015431,"value":"excellent"},"risk_info_notes":{"created_at":1379015431,"updated_at":1379015431,"value":"notess"},"risk_info_limit":{"created_at":1379015431,"updated_at":1379015431,"value":"limitt"},"construction_stories":{"created_at":1379015431,"updated_at":1379015431,"value":"storiess"},"year_built":{"created_at":1379015431,"updated_at":1379015431,"value":"yearss bult"},"construction_area":{"created_at":1379015431,"updated_at":1379015431,"value":{"qty":"12333","unit":"Sq. m."}},"construction_walls":{"created_at":1379015431,"updated_at":1379015531,"value":"wallss"},"construction_floors":{"created_at":1379015431,"updated_at":1379015531,"value":"floorss"},"construction_basement":{"created_at":1379015431,"updated_at":1379015531,"value":"basements"},"construction_roof":{"created_at":1379015431,"updated_at":1379015531,"value":"roofss"},"construction_roof_covering":{"created_at":1379015531,"updated_at":1379015531,"value":"roof coveringg"},"construction_electrical":{"created_at":1379015531,"updated_at":1379015531,"value":"Breakers \u0026 Fuses"},"construction_plumbing":{"created_at":1379015531,"updated_at":1379015531,"value":"plumbing typeee"},"construction_heating":{"created_at":1379015531,"updated_at":1379015531,"value":"Other (describe)"},"construction_fuel":{"created_at":1379015605,"updated_at":1379015605,"value":"dsfsaf"},"renovations_electrical":{"created_at":1379015605,"updated_at":1379015605,"value":{"yes":true}},"renovations_electrical_year":{"created_at":1379015605,"updated_at":1379015605,"value":"111111"},"renovations_electrical_complete_partial":{"created_at":1379015605,"updated_at":1379015605,"value":"complete"},"renovations_plumbing":{"created_at":1379015605,"updated_at":1379015605,"value":{"yes":true}},"renovations_plumbing_year":{"created_at":1379015605,"updated_at":1379015605,"value":"11111"},"renovations_plumbing_complete_partial":{"created_at":1379015605,"updated_at":1379015605,"value":"partial"},"renovations_heating":{"created_at":1379015605,"updated_at":1379015605,"value":{"yes":true}},"renovations_heating_year":{"created_at":1379015605,"updated_at":1379015605,"value":"11111"},"renovations_heating_complete_partial":{"created_at":1379015605,"updated_at":1379015605,"value":"complete"},"renovations_roof":{"created_at":1379015605,"updated_at":1379015605,"value":{"yes":true}},"renovations_roof_year":{"created_at":1379015605,"updated_at":1379015605,"value":"11111"},"renovations_roof_complete_partial":{"created_at":1379015605,"updated_at":1379015605,"value":"partial"},"fire_hydrants":{"created_at":1379015718,"updated_at":1379015718,"value":"Over 300m"},"fire_department":{"created_at":1379015718,"updated_at":1379015718,"value":"Over 13km"},"extinguishing_system":{"created_at":1379015718,"updated_at":1379015718,"value":"extingusting systemmm"},"extinguishing_agent":{"created_at":1379015718,"updated_at":1379015718,"value":"automaticCO2"},"fire_alarm":{"created_at":1379015718,"updated_at":1379015718,"value":"fire alarmm"},"coverage_percent":{"created_at":1379015718,"updated_at":1379015718,"value":"111"},"standpipe":{"created_at":1379015718,"updated_at":1379015718,"value":{"yes":true}},"other_fire_info":{"created_at":1379015718,"updated_at":1379015718,"value":"otherr info"},"protection_types":{"created_at":1379015718,"updated_at":1379015718,"value":{"common_walls":true,"metal_doors":true,"night_illumination":true,"blocked_skylight":true,"stockroom_motion":true}},"burglar_alarm":{"created_at":1379015718,"updated_at":1379015718,"value":"burglar alarmm"},"safe_type":{"created_at":1379015718,"updated_at":1379015718,"value":"fire"},"safe_class":{"created_at":1379015718,"updated_at":1379015718,"value":"safe class"},"crime_protection_other":{"created_at":1379015718,"updated_at":1379015718,"value":"otherr"},"occupancy_insured":{"created_at":1379015718,"updated_at":1379015718,"value":"insuredd"},"occupancy_others":{"created_at":1379015718,"updated_at":1379015718,"value":"otherss"},"exposures_clear":{"created_at":1379015718,"updated_at":1379015718,"value":{}},"exposures_left":{"created_at":1379015718,"updated_at":1379015718,"value":"left of insuredd"},"exposures_right":{"created_at":1379015718,"updated_at":1379015718,"value":"right of insureds"},"exposures_behind":{"created_at":1379015718,"updated_at":1379015718,"value":"behind of insuredd"},"buildings":{"created_at":1379015731,"updated_at":1379017417,"value":[{"id":"14113be282b01738d10e","created_at":1379015731,"updated_at":1379015731,"building_number":{"created_at":1379015731,"updated_at":1379015731,"value":"111"},"address":{"created_at":1379015731,"updated_at":1379015731,"value":"addresss"},"description":{"created_at":1379015731,"updated_at":1379015731,"value":"descriptionnn"},"coinsurance":{"created_at":1379015731,"updated_at":1379015731,"value":"coninsurancee"},"stated_amount":{"created_at":1379015731,"updated_at":1379015731,"value":{"yes":true}},"coverage_type":{"created_at":1379015731,"updated_at":1379015731,"value":"replacement_cost"},"replacement_cost":{"created_at":1379015731,"updated_at":1379015731,"value":"11111"},"rate":{"created_at":1379015731,"updated_at":1379015731,"value":"1111"},"premium":{"created_at":1379015731,"updated_at":1379015731,"value":"1111"}}]},"coverage_schedules":{"created_at":1379015744,"updated_at":1379017417,"value":[{"id":"14113be5d0b034c25191","created_at":1379015744,"updated_at":1379015744,"type":{"created_at":1379015744,"updated_at":1379015744,"value":"Misc. Wording"},"category":{"created_at":1379015744,"updated_at":1379015744,"value":"Other"},"deductible":{"created_at":1379015744,"updated_at":1379015744,"value":"1111"},"coinsurance":{"created_at":1379015744,"updated_at":1379015744,"value":"111"},"limit":{"created_at":1379015744,"updated_at":1379015744,"value":"1111"}}]},"auto_schedules":{"created_at":1379015789,"updated_at":1379017417,"value":[{"id":"14113bf0a840135caf34","created_at":1379015789,"updated_at":1379015789,"item_number":{"created_at":1379015789,"updated_at":1379015789,"value":"111"},"unit_number":{"created_at":1379015789,"updated_at":1379015789,"value":"111"},"owner":{"created_at":1379015789,"updated_at":1379015789,"value":"ownerss"},"finance_company":{"created_at":1379015789,"updated_at":1379015789,"value":"finance companyy"},"year":{"created_at":1379015789,"updated_at":1379015789,"value":"1110"},"make":{"created_at":1379015789,"updated_at":1379015789,"value":"makkee"},"model":{"created_at":1379015789,"updated_at":1379015789,"value":"modell"},"serial_number":{"created_at":1379015789,"updated_at":1379015789,"value":"11221e32`"},"plate_number":{"created_at":1379015789,"updated_at":1379015789,"value":"platee"},"colour":{"created_at":1379015789,"updated_at":1379015789,"value":"colorr"},"lessor":{"created_at":1379015789,"updated_at":1379015789,"value":"lessor "},"date_added":{"created_at":1379015789,"updated_at":1379015789,"value":1379995200},"policy_expiry":{"created_at":1379015789,"updated_at":1379015789,"value":1378872000},"deleted":{"created_at":1379015789,"updated_at":1379015789,"value":1380513600},"premium":{"created_at":1379015789,"updated_at":1379015789,"value":"1111"},"premium_credit":{"created_at":1379015789,"updated_at":1379015789,"value":"1111"},"cargo":{"created_at":1379015789,"updated_at":1379015789,"value":"1111"},"cargo_credit":{"created_at":1379015789,"updated_at":1379015789,"value":"111"}}]},"equipment_schedules":{"created_at":1379015836,"updated_at":1379017417,"value":[{"id":"14113bfc2d702c24803f","created_at":1379015836,"updated_at":1379015836,"type":{"created_at":1379015836,"updated_at":1379015836,"value":"typee"},"item_number":{"created_at":1379015836,"updated_at":1379015836,"value":"1111"},"year":{"created_at":1379015836,"updated_at":1379015836,"value":1990},"make":{"created_at":1379015836,"updated_at":1379015836,"value":"makee"},"model":{"created_at":1379015836,"updated_at":1379015836,"value":"modell"},"serial_number":{"created_at":1379015836,"updated_at":1379015836,"value":"cereal number"},"lessor":{"created_at":1379015836,"updated_at":1379015836,"value":"lessorr"},"description":{"created_at":1379015836,"updated_at":1379015836,"value":"descrip"},"limit":{"created_at":1379015836,"updated_at":1379015836,"value":"limitt"}}]},"miscellaneous_schedules":{"created_at":1379015864,"updated_at":1379017417,"value":[{"id":"14113c030d20312a4a91","created_at":1379015864,"updated_at":1379015864,"type":{"created_at":1379015864,"updated_at":1379015864,"value":"typee"},"item_number":{"created_at":1379015864,"updated_at":1379015864,"value":"111"},"year":{"created_at":1379015864,"updated_at":1379015864,"value":1990},"make":{"created_at":1379015864,"updated_at":1379015864,"value":"makee"},"model":{"created_at":1379015864,"updated_at":1379015864,"value":"modell"},"serial_number":{"created_at":1379015864,"updated_at":1379015864,"value":"serial numberr"},"lessor":{"created_at":1379015864,"updated_at":1379015864,"value":"lessorr"},"description":{"created_at":1379015864,"updated_at":1379015864,"value":"descriptionn"},"limit":{"created_at":1379015864,"updated_at":1379015864,"value":"limitt"}}]},"drivers":{"created_at":1379015909,"updated_at":1379017417,"value":[{"id":"14113c0e0bd01be376dd","created_at":1379015909,"updated_at":1379015909,"driver":{"created_at":1379015909,"updated_at":1379015909,"value":"1`2312"},"name":{"created_at":1379015909,"updated_at":1379015909,"value":"namee"},"license_number":{"created_at":1379015909,"updated_at":1379015909,"value":"11111"},"date_employed":{"created_at":1379015909,"updated_at":1379015909,"value":1378699200},"accidents":{"created_at":1379015909,"updated_at":1379015909,"value":"aciddents"},"convictions":{"created_at":1379015909,"updated_at":1379015909,"value":"convictionsss"}}]},"loss_control_surveys":{"created_at":1379015960,"updated_at":1379017417,"value":[{"id":"14113c1a83c00df309fb","created_at":1379015960,"updated_at":1379015960,"survey_performed_by":{"created_at":1379015960,"updated_at":1379015960,"value":"performedd byyy"},"survey_date":{"created_at":1379015960,"updated_at":1379015960,"value":1378699200},"survey_interviewee":{"created_at":1379015960,"updated_at":1379015960,"value":"person intervieweddd"},"survey_comb_clearance":{"created_at":1379015960,"updated_at":1379015960,"value":{"yes":true}},"survey_wiring":{"created_at":1379015960,"updated_at":1379015960,"value":{"yes":true}},"survey_well_lit":{"created_at":1379015960,"updated_at":1379015960,"value":{"yes":true}},"survey_refueling":{"created_at":1379015960,"updated_at":1379015960,"value":{"yes":true}},"survey_refueling_comment":{"created_at":1379015960,"updated_at":1379015960,"value":"descirbee"},"survey_refueling_disaster_plan":{"created_at":1379015960,"updated_at":1379015960,"value":{"yes":true}},"survey_standpipe":{"created_at":1379015960,"updated_at":1379015960,"value":{"yes":true}},"survey_obstructions":{"created_at":1379015960,"updated_at":1379015960,"value":{"yes":true}},"survey_ulc_equipment":{"created_at":1379015960,"updated_at":1379015960,"value":"ulc equipmenttt"},"survey_alarm_company":{"created_at":1379015960,"updated_at":1379015960,"value":"alarmm companyy"},"survey_heat_motion":{"created_at":1379015960,"updated_at":1379015960,"value":{"yes":true}},"survey_fire_doors":{"created_at":1379015960,"updated_at":1379015960,"value":{"yes":true}},"survey_other":{"created_at":1379015960,"updated_at":1379015960,"value":"other/noteess"}}]},"photos":{"created_at":1379015969,"updated_at":1379017417,"value":[{"id":"14113c1c9c1005f7ce25","created_at":1379015969,"updated_at":1379015969,"photo_notes":{"created_at":1379015969,"updated_at":1379015969,"value":"sdafdas"},"organize_photos":{"created_at":1379015969,"updated_at":1379015969,"value":"Photographer"}}]}}]},"new_client":{"created_at":1379017236,"updated_at":1379017236,"value":{"yes":true}},"notes":{"created_at":1379017236,"updated_at":1379017236,"value":"notess"},"part_time_employees":{"created_at":1379015197,"updated_at":1379015688,"value":"parttimeemploy"},"phone":{"created_at":1379015197,"updated_at":1379015688,"value":"123-456-1234"},"policy_infos":{"created_at":1379015197,"updated_at":1379017417,"value":[{"id":"14113b35f120272e24ab","created_at":1379015197,"updated_at":1379015197,"insurer":{"created_at":1379015197,"updated_at":1379015197,"value":"insurerr"},"policy_type":{"created_at":1379015197,"updated_at":1379015197,"value":"policy typpee"},"policy_number":{"created_at":1379015197,"updated_at":1379015197,"value":"policy #"},"premium":{"created_at":1379015197,"updated_at":1379015197,"value":"111.11"},"premium_monthly_or_annual":{"created_at":1379015197,"updated_at":1379015197,"value":"monthly"},"policy_start":{"created_at":1379015197,"updated_at":1379015197,"value":1378008000},"policy_end":{"created_at":1379015197,"updated_at":1379015197,"value":1410753600},"quote_required_by":{"created_at":1379015197,"updated_at":1379015197,"value":1379217600}}]},"postal_code":{"created_at":1379015197,"updated_at":1379015688,"value":"Posta Code"},"province":{"created_at":1379015197,"updated_at":1379015688,"value":"Province/Satee"},"solar_annual_energy":{"created_at":1379015197,"updated_at":1379015688,"value":"annual energy genrationn"},"solar_energy_sold_to":{"created_at":1379015197,"updated_at":1379015688,"value":"energy sold too"},"solar_host":{"created_at":1379015197,"updated_at":1379015688,"value":"hostt"},"solar_lessor":{"created_at":1379015197,"updated_at":1379015688,"value":"lessor"},"solar_non_workers_compensation":{"created_at":1379015197,"updated_at":1379015688,"value":"non workers compensation"},"solar_project_restricted":{"created_at":1379015197,"updated_at":1379015688,"value":{"yes":true}},"solar_project_restricted_describe":{"created_at":1379015197,"updated_at":1379015688,"value":"describeee"},"solar_subcontractor_coverage":{"created_at":1379015197,"updated_at":1379015688,"value":{"yes":true}},"solar_subcontractor_coverage_additional_insured":{"created_at":1379015197,"updated_at":1379015688,"value":{"yes":true}},"solar_subcontractor_coverage_certificates":{"created_at":1379015197,"updated_at":1379015688,"value":{"yes":true}},"solar_subcontractor_coverage_limit":{"created_at":1379015197,"updated_at":1379015688,"value":"limit required"},"solar_subcontractor_coverage_planned_describe":{"created_at":1379015197,"updated_at":1379015688,"value":"describeeee"},"solar_subcontractor_coverage_planned_sites":{"created_at":1379015197,"updated_at":1379015688,"value":{"yes":true}},"solar_subcontractor_coverage_waive":{"created_at":1379015197,"updated_at":1379015688,"value":{"yes":true}},"solar_subcontracts":{"created_at":1379015197,"updated_at":1379015688,"value":"sub contracts"},"solar_transmission":{"created_at":1379015197,"updated_at":1379015688,"value":{"yes":true}},"solar_transmission_describe":{"created_at":1379015197,"updated_at":1379015688,"value":"describee"},"solar_utility":{"created_at":1379015197,"updated_at":1379015688,"value":"utilityy"},"updated_at":"2013-09-12T20:23:37.000Z","website":{"created_at":1379015197,"updated_at":1379015688,"value":"web sitee"},"policy_start":{"value":1385874000},"policy_end":{"value":1417410000},"insurer_offerings":{"created_at":1379363903,"updated_at":1379364008,"value":[{"id":"141287ed7c5000e6967c","created_at":1379363903,"updated_at":1379363903,"insurer":{"created_at":1379363903,"updated_at":1379363903,"value":"Test Insurer Inc."},"umbrella_premium":{"created_at":1379363903,"updated_at":1379363903,"value":"1234"},"commercial_premium":{"created_at":1379363903,"updated_at":1379363903,"value":"2345"},"total_premium":{"created_at":1379363903,"updated_at":1379363903,"value":"3579"},"policy_number":{"value":1234},"chosen_insurer":{"created_at":1379363903,"updated_at":1379363903,"value":{"yes":true}}},{"id":"14128806ff102cb505f7","created_at":1379364007,"updated_at":1379364007,"insurer":{"created_at":1379364007,"updated_at":1379364007,"value":"Test Insurer 2"},"umbrella_premium":{"created_at":1379364007,"updated_at":1379364007,"value":"9999"},"commercial_premium":{"created_at":1379364007,"updated_at":1379364007,"value":"9999"},"total_premium":{"created_at":1379364007,"updated_at":1379364007,"value":"19998"}}]}}')
data['brokerage_short'] = 'NII'
data['company_short'] = 'C'
data['brokerage'] = JSON.parse('{"_id":{"$oid":"51e4374f5ea3b7ed6700000c"},"address":"315 King St. N","clients":[{"_id":"14103e979da016ec3e87","blanket_coverages":{"created_at":1378753028,"updated_at":1378845894,"value":[{"id":"141098edfe902828876d","created_at":1378844860,"updated_at":1378844860,"type":{"created_at":1378844860,"updated_at":1378844860,"value":"Accounts Receivable (Broad)"},"category":{"created_at":1378844860,"updated_at":1378844860,"value":"Property"},"deductible":{"created_at":1378844860,"updated_at":1378844860,"value":"1000"},"coinsurance":{"created_at":1378844860,"updated_at":1378844860,"value":""},"limit":{"created_at":1378844860,"updated_at":1378844860,"value":"50000"}}]},"brokerage_id":{"$oid":"51e4374f5ea3b7ed6700000c"},"business_sector":{"created_at":1378750152,"updated_at":1378750152,"value":"Generic"},"claims_infos":{"created_at":1378844910,"updated_at":1378845894,"value":[{"id":"1410995c21e037e54f58","created_at":1378845311,"updated_at":1378845343,"loss_date":{"created_at":1378845311,"updated_at":1378845311,"value":1378180800},"claim_type":{"created_at":1378845331,"updated_at":1378845343,"value":""}}]},"company_name":{"created_at":1378750152,"updated_at":1378750152,"value":"Test Company"},"covered":{"created_at":1378838244,"updated_at":1378838244,"value":""},"created_at":"2013-09-09T18:09:12.892Z","deleted_at":null,"editing_time":321,"form_of_business":{"created_at":1378845156,"updated_at":1378845156,"value":"Individual"},"locations":{"created_at":1378750185,"updated_at":1378845894,"value":[{"id":"14103e9df9203b068efd","created_at":1378750185,"updated_at":1378845894,"location_number":{"created_at":1378750185,"updated_at":1378750185,"value":"1"},"construction_area":{"created_at":1378753331,"updated_at":1378753331,"value":{"qty":"1234","unit":"Sq. m."}},"renovations_plumbing":{"created_at":1378753338,"updated_at":1378753338,"value":{}},"buildings":{"created_at":1378750684,"updated_at":1378845894,"value":[{"id":"141098bcb1b03a438de9","created_at":1378844658,"updated_at":1378844658,"building_number":{"created_at":1378844658,"updated_at":1378844658,"value":"1234"}}]},"coverage_schedules":{"created_at":1378750185,"updated_at":1378845894,"value":[{"id":"141055f19d601807ec7f","created_at":1378774620,"updated_at":1378774620,"type":{"created_at":1378774620,"updated_at":1378774620,"value":"Computers"},"category":{"created_at":1378774620,"updated_at":1378774620,"value":"Property"},"subtype":{"created_at":1378774620,"updated_at":1378774620,"value":"broad"},"deductible":{"created_at":1378774620,"updated_at":1378774620,"value":"1000"},"coinsurance":{"created_at":1378774620,"updated_at":1378774620,"value":"90%"},"limit":{"created_at":1378774620,"updated_at":1378774620,"value":"25000"}}]}},{"id":"141098deebc025ba4a12","created_at":1378844812,"updated_at":1378844812,"location_number":{"created_at":1378844812,"updated_at":1378844812,"value":"2"},"location_type":{"created_at":1378844812,"updated_at":1378844812,"value":"Urban"}}]},"policy_infos":{"created_at":1378844471,"updated_at":1378844765,"value":[]},"prev_policy_infos":{"created_at":1378845892,"updated_at":1378845894,"value":[{"id":"141099e9f93018b3fa04","created_at":1378845892,"updated_at":1378845892,"insurer":{"created_at":1378845892,"updated_at":1378845892,"value":"1234"},"policy_type":{"created_at":1378845892,"updated_at":1378845892,"value":"CGL"}}]},"updated_at":"2013-09-10T20:44:54.000Z","website":{"created_at":1378844905,"updated_at":1378845818,"value":""}},{"_id":"14109a001d602530b7a8","account_number":{"created_at":1378846443,"updated_at":1378846469,"value":"12345"},"brokerage_id":{"$oid":"51e4374f5ea3b7ed6700000c"},"business_sector":{"created_at":1378845993,"updated_at":1378845993,"value":"Generic"},"company_name":{"created_at":1378845993,"updated_at":1378845993,"value":"SciGit"},"created_at":"2013-09-10T20:46:33.435Z","deleted_at":null,"editing_time":91,"form_of_business":{"created_at":1378845993,"updated_at":1378845993,"value":"Corporation"},"updated_at":"2013-09-10T20:57:48.000Z","website":{"created_at":1378846029,"updated_at":1378846668,"value":"12345"}}],"contacts":[{"name":"asdf","title":"asdf"}],"created_at":"2013-07-15T17:54:23.641Z","deleted_at":null,"employees":22,"fax":"","name":"SciGit Inc.","num_clients":null,"phone":"5194048124","updated_at":"2013-08-15T23:26:45.765Z","website":"www.scigit.com"}')

fields = YAML::load(File.open('client.yml'))
argv = ARGV.dup
if !argv[0].nil?
  if defined? RubyProf
    RubyProf.start
  end

  YDocx::Document.fill_template(argv[0], data, fields, argv[1] || (File.basename(argv[0], '.docx') + '.out.docx'), options)
  if defined? RubyProf
    result = RubyProf.stop
    printer = RubyProf::GraphHtmlPrinter.new(result)
    printer.print(STDOUT)
  end
  puts 'Successfully filled template with data.'
else
  puts 'usage: templatex [options] template_file output_file'
end
